{"version":3,"sources":["pages/admin/children/resources-admin/add-form.jsx","pages/admin/children/resources-admin/index.jsx"],"names":["Option","beforeUpload","file","isJpgOrPng","type","message","error","isLt2M","size","AddFrom","props","saveResource","a","state","imageUrl","url","name","cate","desc","warning","isUpdate","id","resource","reqUpdateResources","res","reqAddResources","code","success","msg","setState","QcEventEmitter","emit","handleCloseModal","handleChange","info","status","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","getBase64","originFileObj","loading","handleInputValue","e","target","value","this","uploadButton","LoadingOutlined","PlusOutlined","style","marginTop","title","visible","isModalVisible","onOk","onCancel","okText","cancelText","labelCol","span","wrapperCol","Item","label","placeholder","onChange","listType","className","showUploadList","action","src","alt","width","defaultValue","resourcesCate","map","item","Math","random","PureComponent","randomColor","r","g","b","ResourcesAdmin","handleDeleteResource","confirm","content","reqDeleteResources","handleUpdateResource","currentResource","handleAddResources","columns","render","background","dataIndex","key","icon","EditOutlined","onClick","danger","DeleteOutlined","pathname","match","params","resourceCate","find","bordered","dataSource","children","rowKey","Component"],"mappings":"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","file":"static/js/5.f2b14ff0.chunk.js","sourcesContent":["import React, { PureComponent } from 'react';\r\nimport { Modal, Input, Form, Select, Upload, message } from 'antd'\r\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport { reqAddResources, reqUpdateResources } from '@/api'\r\nimport QcEventEmitter from '@/utils/QcEventEmitter'\r\n\r\nconst Option = Select.Option\r\n\r\nconst getBase64 = (img, callback) => {\r\n  const reader = new FileReader();\r\n  reader.addEventListener('load', () => callback(reader.result));\r\n  reader.readAsDataURL(img);\r\n}\r\n\r\nconst beforeUpload = (file) => {\r\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\r\n  if (!isJpgOrPng) {\r\n    message.error('You can only upload JPG/PNG file!');\r\n  }\r\n  const isLt2M = file.size / 1024 / 1024 < 2;\r\n  if (!isLt2M) {\r\n    message.error('Image must smaller than 2MB!');\r\n  }\r\n  return isJpgOrPng && isLt2M;\r\n}\r\n\r\nclass AddFrom extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    const { resource } = props\r\n    if (resource.name) {\r\n      this.state = {\r\n        loading: false,\r\n        ...resource\r\n      }\r\n    } else {\r\n      this.state = {\r\n        loading: false,\r\n        imageUrl: '',\r\n        url: '',\r\n        name: '',\r\n        cate: '',\r\n        desc: ''\r\n      }\r\n    }\r\n  }\r\n  // 保存到后台\r\n  saveResource = async () => {\r\n    const { imageUrl, url, name, cate, desc } = this.state\r\n    if (!name || !cate || !url) {\r\n      message.warning(\"请填写 网站地址,名称,选择分类\")\r\n      return\r\n    }\r\n    // 根据是更新/添加 发送不同的后台请求\r\n    let res\r\n    if (this.isUpdate) {\r\n      // 添加\r\n      const id = this.props.resource.id\r\n      res = await reqUpdateResources({ imageUrl, url, name, cate, desc, id })\r\n    } else {\r\n      // 添加\r\n      res = await reqAddResources({ imageUrl, url, name, cate, desc })\r\n    }\r\n\r\n    // 处理结果\r\n    if (res.code === 0) {\r\n      message.success(res.msg)\r\n      this.setState({\r\n        imageUrl: '',\r\n        url: '',\r\n        name: '',\r\n        cate: '',\r\n        desc: '',\r\n      })\r\n      QcEventEmitter.emit('getResourcesCate')\r\n      this.handleCloseModal()\r\n    } else {\r\n      message.warning(res.msg)\r\n    }\r\n\r\n  }\r\n\r\n  // 图片上传控件\r\n  handleChange = info => {\r\n    if (info.file.status === 'uploading') {\r\n      this.setState({ loading: true });\r\n      return;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      // Get this url from response in real world.\r\n      getBase64(info.file.originFileObj, imageUrl =>\r\n        this.setState({\r\n          imageUrl,\r\n          loading: false,\r\n        }),\r\n      );\r\n    }\r\n  };\r\n\r\n  // 处理表单输入\r\n  handleInputValue = (name) => {\r\n    return (e) => {\r\n      if (e.target) {\r\n        const value = e.target.value\r\n        this.setState({\r\n          [name]: value\r\n        })\r\n      } else {\r\n        this.setState({\r\n          [name]: e\r\n        })\r\n      }\r\n\r\n    }\r\n  }\r\n  // 处理对话框关闭\r\n  handleCloseModal = () => {\r\n    this.setState({\r\n      loading: false,\r\n      imageUrl: '',\r\n      url: '',\r\n      name: '',\r\n      cate: '',\r\n      desc: ''\r\n    }, () => {\r\n      // 通知父组件\r\n      this.isUpdate = false\r\n      this.props.handleCloseModal()\r\n    })\r\n  }\r\n  componentDidUpdate() {\r\n    const { resource } = this.props\r\n    if (!this.isUpdate && resource.name && resource.name !== this.state.name) {\r\n      this.setState({\r\n        ...resource\r\n      })\r\n      // 标记此次是更新资源\r\n      this.isUpdate = true\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const layout = {\r\n      labelCol: { span: 4 },\r\n      wrapperCol: { span: 16 },\r\n    }\r\n    const { loading, imageUrl, name, desc, url, cate } = this.state;\r\n\r\n    const uploadButton = (\r\n      <div>\r\n        {loading ? <LoadingOutlined /> : <PlusOutlined />}\r\n        <div style={{ marginTop: 8 }}>Upload</div>\r\n      </div>\r\n    );\r\n\r\n    return (<Modal\r\n      title=\"添加资源\"\r\n      visible={this.props.isModalVisible}\r\n      onOk={this.saveResource}\r\n      onCancel={this.handleCloseModal}\r\n      okText=\"添加\"\r\n      cancelText=\"取消\"\r\n    >\r\n      <Form\r\n        {...layout}\r\n        name=\"添加资源\"\r\n      >\r\n        {/* 地址 */}\r\n        <Form.Item\r\n          label=\"网站地址\"\r\n        >\r\n          <Input placeholder=\"http://\" value={url} onChange={this.handleInputValue('url')} />\r\n        </Form.Item>\r\n        {/* 名字 */}\r\n        <Form.Item\r\n          label=\"资源名称\"\r\n        >\r\n          <Input value={name} onChange={this.handleInputValue('name')} />\r\n        </Form.Item>\r\n        {/* 描述 */}\r\n        <Form.Item\r\n          label=\"描述\"\r\n        >\r\n          <Input value={desc} onChange={this.handleInputValue('desc')} />\r\n        </Form.Item>\r\n        {/* 图标 */}\r\n        <Form.Item\r\n          label=\"图标\"\r\n        >\r\n          <Upload\r\n            name=\"avatar\"\r\n            listType=\"picture-card\"\r\n            className=\"avatar-uploader\"\r\n            showUploadList={false}\r\n            action=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\r\n            beforeUpload={beforeUpload}\r\n            onChange={this.handleChange}\r\n          >\r\n            {imageUrl ? <img src={imageUrl} alt=\"avatar\" style={{ width: '100%' }} /> : uploadButton}\r\n          </Upload>\r\n        </Form.Item>\r\n        {/* src图标 */}\r\n        <Form.Item\r\n          label=\"图标Src\"\r\n        >\r\n          <Input value={imageUrl} onChange={this.handleInputValue('imageUrl')} />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          label=\"资源分类\"\r\n        >\r\n          <Select defaultValue={cate} placeholder=\"选择资源分类\" style={{ width: 120 }} onChange={this.handleInputValue('cate')} key={Math.random()} >\r\n            {this.props.resourcesCate.map(item => (\r\n              <Option key={item.name} value={item.name}>{item.name}</Option>\r\n            ))}\r\n          </Select>\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>);\r\n  }\r\n}\r\n\r\nexport default AddFrom;","import React, { Component } from 'react';\r\nimport { Card, Button, Modal, message, Table } from 'antd'\r\nimport AddForm from './add-form'\r\nimport {\r\n  EditOutlined,\r\n  DeleteOutlined\r\n} from '@ant-design/icons'\r\nimport { reqDeleteResources } from '@/api'\r\nimport QcEventEmitter from '@/utils/QcEventEmitter'\r\nimport './index.less'\r\n\r\nfunction randomColor() {\r\n  const r = Math.random() * 255\r\n  const g = Math.random() * 255\r\n  const b = Math.random() * 255\r\n  const a = Math.random() * 1\r\n  return `rgba(${r}, ${g}, ${b},${a})`\r\n}\r\n\r\n\r\nclass ResourcesAdmin extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isModalVisible: false,\r\n      currentResource: {}\r\n    }\r\n    // 表单头\r\n    this.columns = [\r\n      {\r\n        title: '网站名称',\r\n        render: resource => {\r\n          return (\r\n            <div className=\"resource_img\">\r\n              {\r\n                resource.imageUrl ? <img src={resource.imageUrl} alt=\"\" /> : <div style={{ background: randomColor() }} >{resource.name}</div>\r\n              }\r\n            </div>\r\n\r\n          )\r\n        }\r\n      },\r\n      {\r\n        title: '网站名称',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n      },\r\n      {\r\n        title: '网站描述',\r\n        dataIndex: 'desc',\r\n        key: 'desc',\r\n      },\r\n      {\r\n        width: 180,\r\n        title: '操作',\r\n        render: resource => {\r\n          return <div className=\"resource_update_btn\" >\r\n            <Button type=\"primary\" size=\"small\" icon={<EditOutlined />} onClick={this.handleUpdateResource(resource)} >编辑</Button> &nbsp;\r\n            <Button danger size=\"small\" icon={<DeleteOutlined />} onClick={this.handleDeleteResource(resource)} >删除</Button>\r\n          </div>\r\n        }\r\n      }\r\n    ];\r\n  }\r\n  // 删除对应资源\r\n  handleDeleteResource = (resource) => {\r\n    return () => {\r\n      Modal.confirm({\r\n        content: \"你真的要删除 \" + resource.name + \" 吗?\",\r\n        onOk: async () => {\r\n          const { cate, id } = resource\r\n          const res = await reqDeleteResources(cate, id)\r\n          if (res.code === 0) {\r\n            message.success(res.msg)\r\n            QcEventEmitter.emit('getResourcesCate')\r\n\r\n          } else {\r\n            message.warning(res.msg)\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n  // 编辑对应resource\r\n  handleUpdateResource = (resource) => {\r\n    return () => {\r\n      this.setState({\r\n        isModalVisible: true,\r\n        currentResource: resource\r\n      })\r\n    }\r\n  }\r\n  // 打开添加资源分类对话框\r\n  handleAddResources = () => {\r\n    this.setState({\r\n      isModalVisible: true,\r\n      currentResource: {}\r\n    })\r\n  }\r\n  // 关闭对话框\r\n  handleCloseModal = () => {\r\n    this.setState({\r\n      isModalVisible: false,\r\n      currentResource: {}\r\n    })\r\n  }\r\n\r\n\r\n  render() {\r\n    const { isModalVisible, currentResource } = this.state\r\n\r\n    const pathname = this.props.match.params.name\r\n    const resourceCate = this.props.resourcesCate.find(item => item.name === pathname)\r\n  \r\n    return (\r\n      <Card title={<Button type=\"primary\" onClick={this.handleAddResources}>添加资源</Button>} className=\"resources_admin\">\r\n        <Table bordered dataSource={resourceCate && resourceCate.children} rowKey=\"id\" columns={this.columns} />\r\n        {/* 添加资源表单 */}\r\n        <AddForm isModalVisible={isModalVisible} handleCloseModal={this.handleCloseModal} resourcesCate={this.props.resourcesCate}  resource={currentResource} />\r\n      </Card>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ResourcesAdmin;"],"sourceRoot":""}